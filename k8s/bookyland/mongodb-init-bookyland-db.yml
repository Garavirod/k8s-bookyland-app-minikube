apiVersion: v1
kind: ConfigMap
metadata:
  name: mongodb-init-bookyland-db
  labels:
    app: mongodb
data: 
  mongo-init.py: | # This is the script that will be used to initialize the database
    #!/usr/bin/env python3
    import os
    from pymongo import MongoClient
    
    def init_database():
        db_name = os.getenv('DB_NAME')
        db_user = os.getenv('DB_USER')
        db_password = os.getenv('DB_PASSWORD')
        
        # Connect to MongoDB (default: localhost:27017)
        client = MongoClient('mongodb://localhost:27017/')
        db = client[db_name]
        
        print(f'INITIALIZING: {db_name}')
        print(f'INITIALIZING: Creating user {db_user}')
        
        # Create user
        db.command('createUser', db_user, pwd=db_password, roles=[
            {
                'role': 'readWrite',
                'db': db_name
            }
        ])
        
        print("Database initialization completed!")
    
    if __name__ == "__main__":
        init_database()
